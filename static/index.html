<!doctype html>
<html>
<head>
    <style>
        #accounts > table {
            width: 600px;
            margin: auto;
        }
        #accounts tr {
            margin: 0;
        }
        #accounts td {
            border: 1px solid #888;
            text-align: right;
            margin: 0 2em;
            max-width: 200px;
            overflow: hidden;
        }
    </style>
</head>
<body>

    <h3>Cryptonomicon</h3>

    <a href="cheque.html">Make a transaction</a>

    <a href="password.html">Set Password</a>

    <a href="https://passwordsgenerator.net/sha256-hash-generator/" target="_blank">SHA256 Hash Generator</a>

    <div id="accounts"></div>


<script type="text/html" id="table-template">
    <table>
        <tr>
            <th>Account</th>
            <th>Password</th>
            <th>Balance</th>
        </tr>
    </table>
</script>
<script type="text/html" id="account-template">
    <tr>
        <td name="id"></td>
        <td name="password"></td>
        <td><span name="balance"></span>&nbsp;Â¤</td>
    </tr>
</script>

<script type="text/javascript" src="socket.io.min.js"></script>
<script type="text/javascript" src="fetch.js"></script>
<script type="text/javascript" src="lib.js"></script>
<script>
function renderAccount(account) {
    var row = $("[data-account-id='"+account.id+"']");
    if (!row) {
        var table = $("#accounts>table");
        var row = render($('#account-template'), {});
        row.setAttribute('data-account-id', account.id);
        table.appendChild(row);
    }
    setValues(row, account);
}
function renderAccounts(accounts) {
    $$("[data-account-id]").forEach(function(row,i){
        var rowId = row.getAttribute('data-account-id');
        if (typeof accounts[rowId] === 'undefined') {
            row.remove();
        }
    });
    Object.keys(accounts).forEach(function(id) {
        renderAccount(accounts[id]);
    });
}
(function(){
    var table = render($('#table-template'));
    $('#accounts').innerHTML = '';
    $('#accounts').appendChild(table);

})();
function updateAccounts() {
    fetch('/api/accounts').then(function(response){
        return response.json();
    })
    .then(function(accountsData){
        renderAccounts(accountsData);
    });
}
// setInterval(updateAccounts, 1000);
// updateAccounts();

var socket = io.connect('http://' + document.domain + ':' + location.port);
socket.on('connect', function() {
    socket.emit('new_client', {data: 'I\'m connected!'});
});
socket.on('accounts_data', function(data) {
    updateAccounts(data.accounts);
});

</script>
</body>
</html>
